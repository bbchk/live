name: Preview
# on:
#   workflow_run:
#     workflows: ["Back-end", "Front-end"]
#     types:
#       - completed
#   workflow_dispatch:

on:
  push:
    branches: [main, dev]
  workflow_dispatch:

env:
  VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
  VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
  VERCEL_PROJECT_ID: ${{ secrets.VERCEL_FRONT_PROJECT_ID }}

jobs:
  preview:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          npm: cache

      - name: Install Dependencies
          run: cd back && npm install
        - name: Deploy
          uses: amondnet/vercel-action@v19
          with:
            vercel-token: $VERCEL_TOKEN
            vercel-org-id: $VERCEL_ORG_ID
            vercel-project-id: $VERCEL_PROJECT_ID
            vercel-args: '--prod'

      # - name: Install Vercel CLI
        # run: npm install --global vercel@latest && vercel link --repo --yes --token $VERCEL_TOKEN
        # working-directory: back

      # - name: Install Vercel CLI
        # run: npm install --global vercel@latest
      # - run: vercel pull --yes --environment=production --token=${{ secrets.VERCEL_TOKEN }}
      # - run: vercel build --prod --token=${{ secrets.VERCEL_TOKEN }}
      # - name: Deploy
        # run: cd back && vercel --token $VERCEL_TOKEN --prod
